/*! rmsWebconfig 2014-03-14 author:hellangel*/
!function(){window.HAT||(window.HAT={})}(),HAT.Player={playerObject:null,_data:{},_playerVersion:"2.0.4.7",_playerUrl:"asset/NPPlayer.exe",target:{addDevice:"device/add",enumNode:"node/enum",addChannel:"channel/add",openStream:"stream/open",closeStream:"stream/close"},initData:function(){var a=HAT.cookie.getCookie();if(!HAT.isOwnEmpty(HAT.Param.param)&&a){var b=HAT.Param.param,c=HAT.Player._data;c.devname=b.rms_id,c.devtype="rms",c.devip=document.location.hostname,c.devport=Number(b.rms_foreign_port),c.username=a.username,c.password=a.password,c.isencrypt=0,c.ext="ext",c.nodeid="*",c.chanid="",c.streamtype=0,c.protocal="tcp",c._id="",this.addDev()}},_handle:function(a,b){var c={target:a||"",action:"set",sid:"e55ae30a1441a2bc14c4d078",data:b||""};return this.playerObject.videoCtrl.handleComponent(c,3)},checkPlugin:function(){return"msie"===HAT.Main.agent().name?this.playerObject.videoCtrl.getVersion()?!0:(confirm("系统运行需要播放插件，是否下载？\n【安装前请关闭所有打开浏览器】")&&(location.href=this._playerUrl),!1):HAT.Main.hasPlugin("NPPlayer")?!0:(confirm("系统运行需要播放插件，是否下载？\n【安装前请关闭所有打开浏览器】")&&(location.href=this._playerUrl),!1)},init:function(){var a={bWindowMode:1,bShowScreenCtrl:1,bShowPlayCtrl:1,bShowParaCtrl:0,iWhichShowOnTop:0,oControl:{bRecord:0,bTalkback:0,bCapture:0,bAudio:0,bStopAll:0,bStop:0,bReplay:0,bVideoPath:1},oWindow:{bOne:!0,bFour:!0,bNine:!0,bFull:!0}};if(this.playerObject=new JSVideoCtrl($("#playerDiv"),1,"lib/videoPlugin/css/plugin.css",a,""),this.playerObject.draw(),"msie"===HAT.Main.agent().name?this.playerObject.setPosition(-90,-40):HAT.Player.playerObject.videoCtrl.setVisibility(!1),!this.checkPlugin())return!1;var b=this.playerObject.videoCtrl.getVersion();if(b&&b<this._playerVersion){$("#upgradeCrtl_description").html("您当前的控件版本为("+b+"),检测到新版本播放器("+this._playerVersion+")是否下载更新？\n【安装前请关闭所有打开浏览器】");var c=$("#frm-upgradeControl");$("#frm-upgradeControl-submit").bind("click",function(){HAT.Dialog.hide(),window.location.href=HAT.Player._playerUrl}),HAT.Dialog.init(c,"视频控件更新","add").show()}this.regEventCallback()},regEventCallback:function(){var a=this.playerObject;a.videoCtrl.eventCtrl.regInitFinished(function(){HAT.Player.playerObject.tellGetInitEvent(),HAT.Player.playerObject.videoCtrl.setVisibility(!1),HAT.Player.playerObject.videoCtrl.setScreenNum(1),HAT.Player.playerObject.resize(1,1),HAT.Player.playerObject.setDebugMode(!1),HAT.Param.initPage(),HAT.User.initPage()}),a.videoCtrl.eventCtrl.regPlayEvent(function(a){var b=JSON.parse(a);if(0!=b.code){var c="播放错误,<span style='color:red;'>"+b.code+", "+HAT.Main._errCmd[b.code]+"</span>";HAT.Player.playerObject.uiCtrl.setTitleContext(c)}HAT._log._console("Play____"+a)}),a.videoCtrl.eventCtrl.regStopEvent(function(a){HAT.Main.layer.clear(),HAT._log._console("StopEvent_____"+a)}),a.videoCtrl.eventCtrl.regStopAllEvent(function(a){HAT.Main.layer.clear(),HAT._log._console("stopAll____"+a)}),a.videoCtrl.eventCtrl.regDevAdd(function(a){HAT._log._console("DevAdd_____"+a)}),a.videoCtrl.eventCtrl.regDevConnectEvent(function(a){HAT._log._console("DevConnectEvent_____"+a)}),a.videoCtrl.eventCtrl.regEnumNode(function(a){HAT._log._console("EnumNode_____"+a)}),a.videoCtrl.eventCtrl.regAddChannel(function(a){HAT._log._console("addChannel_____"+a)}),a.videoCtrl.eventCtrl.regStreamConnectError(function(){HAT.msg.infoWarning("流连接错误!")})},addDev:function(){this._handle(HAT.Player.target.addDevice,this._data)},enumNode:function(){this._handle(HAT.Player.target.enumNode,this._data)},addChannel:function(a,b,c){var d={devname:a,pid:c,chanid:b,chncap:b+"#0#tcp"};this._handle(HAT.Player.target.addChannel,d)},play:function(a,b){HAT.Player.playerObject.videoCtrl.setVisibility(!0),HAT.Player.playerObject.videoCtrl.setScreenNum(1),HAT.Player.playerObject.uiCtrl.setTitleContext(b||""),this._data.chanid=a||"",this._handle(HAT.Player.target.openStream,this._data),this.playerObject.resize(500,350),HAT.Main.layer.add()},stop:function(){this._handle(HAT.Player.target.closeStream,this._data),HAT.Player.playerObject.videoCtrl.setVisibility(!1),HAT.Main.layer.clear()}};